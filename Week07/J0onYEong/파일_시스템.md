# 파일시스템

안녕하세요 이번주 CS교육을 맡게된 최준영이라고 합니다. 

오늘은 파일시스템에 대해 발표해 보겠습니다. 

컴퓨터를 사용한다면 파일에 대해 접해보신적이 있으실 겁니다.

아시다시피 컴퓨터는 디스크라는 저장장치를 가지고 있고 거기에 파일을 저장할 것입니다.  

하지만 디스크는 단지 나열된 저장공간을 뿐입니다.

넣어야할 짐은 가득하지만 박스도 선반도 없는 창고로 비유할 수 있겠습니다.

파일안에 담긴 내용들은 앞선 그림의 짐들입니다.

이 짐들을 어떤 상자에 담아 어떤 선반에 놓을지 결정하는 시스템이 파일시스템입니다.

우선 컴퓨터는 디스크를 파티션으로 나눕니다. 그리고 각 파티션마다 하나의 파일 시스템이 사용 되게 됩니다.

하나의 방식이 하나의 구역을 관할하는 것이지요

windows운영체제를 사용하는 분들이라면 아마 C드라이브 D드라이브에 대해 들어본적이 있을 겁 니다.

이 둘은 서로 다른 파티션이며 서로 독립된 파일 시스템에 의해 운영됩니다.

즉, C드라이브에 있는 파일에서 D드라이브에 있는 파일을 감지할 수 없습니다.

여기서 파일을 감지할 수 없다는 것은 C드라이브 내부 파일시스템에서 D드라이브의 파일을 찾아 낼 수 없음을 의미합니다.

먼저 디스크는 일련의 블럭들로 나누어져 있습니다.

이 블럭들을 파일들에게 어떻게 할당할 것이고 특정 블럭이 어떤 파일의 것인지 확인하는 것이 핵심입니다.

## File Allocation Table

FAT방식에 대해 먼저 설명드리겠습니다.

이 방식에서 블럭들을 묶어 클러스터라는 것을 구성하게 됩니다.

클러스터는 가변적인 크기가 아니라 정해진 크기이며 모두 동일한 수의 블럭을 가집니다.

FAT방식에서 파일들은 클러스트들의 집합으로 표현됩니다.

파일들이 클러스터들로 구성된다면 동일한 파일의 클러스터들은 디스크에 일렬로 배치될까요?

그렇게 한다면 특정 파일을 삭제하고 집어넣는 과정에서 파일들의 크기가 제각각이라 빈공간이 발생하게 됩니다.

이를 컴퓨터 용어로는 External Fragmentation이라고합니다.

빈공간을 최대한 매우기 위해 파일의 클러스터들은 분산되어 저장되게 됩니다.

이렇게 하면 특정 파일이 삭제되어 빈공간이 생겨도 손실이 없습니다.

그런데 이렇게 뒤죽박죽 썪여있는 클러스터의 주인이 누군지 어떻게 알까요?

그것에 대한 정보를 저장하고 있는 것이 FAT입니다.

FAT테이블을 잘보시면 클러스터 번호에 또다른 클러스터에 값이 저장되어 있는 것을 확인할 수 있습니다.

특정 파일의 다음 클러스터 정보를 정장한 것이 바로 FAT인 거죠 FAT의 장점은 앞서 언급한 것들입니다.

단점은 뭐가 있을 까요?

FAT의 index는 16비트로 구성됩니다.

즉 클러스트의 수는 2의 16승으로 고정되어 있습니다.

그런데 디스크의 크기가 커지면 어떻게 될까요

당연하게도 클러스터의 크기가 커지게 됩니다.

클러스터의 크기가 커지게 되면 문제가 발생합니다.

클러스터 내부에 사용하지 않는 공간이 증가됩니다.

이를 컴퓨터 용어로 Internal Fragmentation이라고 합니다.

또다른 문제로는 파일의 수가 제한적일 수 있습니다.

파일은 최소한 하나의 클러스터를 가져야 합니다. 클러스터의 수는 최대 64K임으로
파일의 수도 대략 6만 5천개로 제한됩니다.

그리고 가장 치명적은 문제는 FAT테이블이 손상될 경우 모든 파일이 손실됩니다.

클러스터 자체는 같은 파일의 클러스터들에 대한 정보가 주어지지 않기 때문입니다.

FAT문제점을 살펴보았으니 실제로 사용되는 I node방식에 대해 소개하겠습니다.

## I node

I node는 특정 파일이나 디렉토리 마다 하나씩 할당됩니다.

I node들은 I node number이라는 속성으로 식별될 수 있습니다.

I node는 FAT처럼 클러스트를 사용하지 않고 블럭단위로 디스크에 접근합니다.

한 파일은 여러 블럭들로 구성되게 되는데 이 블럭들에 대한 정보는 Inode를 통해 알 수 있습니다.

여기까지보면 FAT과 차이점이 없어 보입니다. 

하지만 I node는 블럭의 연결 정보를 따로 Table에 저장하지 않습니다.

따라서 특정 테이블이 삭제된다고 해서 Disk의 블럭들간의 상관관계를 잃는 일은 발생하지 않습니다.

Disk내부 블럭 자체에 해당정보가 저장되기 때문입니다.

